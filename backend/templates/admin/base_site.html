{% extends "admin/base.html" %}

{% block extrahead %}
{{ block.super }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 1. Ek notification sound set karein (Apne static folder me ek sound file rakh lena)
        // Ensure kijiye ki aapne static folder me sounds/ring.mp3 rakhi ho
        const orderSound = new Audio('/static/sounds/ring.mp3');

        // 2. WebSocket se connect karein
        // Yeh URL hum aage configure karenge routing me
        const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
        const socketUrl = protocol + window.location.host + '/ws/admin-notifications/';
        const adminSocket = new WebSocket(socketUrl);

        // ðŸ‘‡ YEH NAYA CODE ADD KAREIN ðŸ‘‡
        adminSocket.onopen = function(event) {
            console.log("ðŸŸ¢ WebSocket Server se Connect ho gaya hai!");
        };

        adminSocket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (data.type === 'new_order') {
                orderSound.play().catch(function(error) {
                    console.log("Sound play error:", error);
                });
            }
        };

        // ðŸ‘‡ ISKO UPDATE KAREIN ðŸ‘‡
        adminSocket.onclose = function(event) {
            console.error('ðŸ”´ Admin notification socket band ho gaya. Code:', event.code, 'Reason:', event.reason);
        };

        // Browser Autoplay Policy Hack: 
        // Browser apne aap sound nahi bajane deta jab tak admin click na kare.
        // Yeh code admin ke pehle click par sound ki permission le lega.
        document.body.addEventListener('click', function unlockAudio() {
            orderSound.play().then(() => {
                orderSound.pause();
                orderSound.currentTime = 0;
            }).catch(err => {});
            document.body.removeEventListener('click', unlockAudio);
        }, { once: true });
    });
</script>
{% endblock %}